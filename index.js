!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Deutung=t()}(this,function(){"use strict";var e=function(e,t){var r=/::\.|[^ ]*::/,n=e;return t.reduce(function(e,t){return e.replace(r,t)},n)};"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function t(e,t){return e(t={exports:{}},t.exports),t.exports}var r=t(function(e,t){var r;r=function(){var e=[],t=[],r={},n={},i={};function o(e){return"string"==typeof e?new RegExp("^"+e+"$","i"):e}function a(e,t){return e===t?t:e===e.toUpperCase()?t.toUpperCase():e[0]===e[0].toUpperCase()?t.charAt(0).toUpperCase()+t.substr(1).toLowerCase():t.toLowerCase()}function u(e,t){return e.replace(t[0],function(r,n){var i,o,u=(i=t[1],o=arguments,i.replace(/\$(\d{1,2})/g,function(e,t){return o[t]||""}));return a(""===r?e[n-1]:r,u)})}function s(e,t,n){if(!e.length||r.hasOwnProperty(e))return t;for(var i=n.length;i--;){var o=n[i];if(o[0].test(t))return u(t,o)}return t}function c(e,t,r){return function(n){var i=n.toLowerCase();return t.hasOwnProperty(i)?a(n,i):e.hasOwnProperty(i)?a(n,e[i]):s(i,n,r)}}function l(e,t,r,n){return function(n){var i=n.toLowerCase();return!!t.hasOwnProperty(i)||!e.hasOwnProperty(i)&&s(i,i,r)===i}}function f(e,t,r){return(r?t+" ":"")+(1===t?f.singular(e):f.plural(e))}return f.plural=c(i,n,e),f.isPlural=l(i,n,e),f.singular=c(n,i,t),f.isSingular=l(n,i,t),f.addPluralRule=function(t,r){e.push([o(t),r])},f.addSingularRule=function(e,r){t.push([o(e),r])},f.addUncountableRule=function(e){"string"!=typeof e?(f.addPluralRule(e,"$0"),f.addSingularRule(e,"$0")):r[e.toLowerCase()]=!0},f.addIrregularRule=function(e,t){t=t.toLowerCase(),e=e.toLowerCase(),i[e]=t,n[t]=e},[["I","we"],["me","us"],["he","they"],["she","they"],["them","them"],["myself","ourselves"],["yourself","yourselves"],["itself","themselves"],["herself","themselves"],["himself","themselves"],["themself","themselves"],["is","are"],["was","were"],["has","have"],["this","these"],["that","those"],["echo","echoes"],["dingo","dingoes"],["volcano","volcanoes"],["tornado","tornadoes"],["torpedo","torpedoes"],["genus","genera"],["viscus","viscera"],["stigma","stigmata"],["stoma","stomata"],["dogma","dogmata"],["lemma","lemmata"],["schema","schemata"],["anathema","anathemata"],["ox","oxen"],["axe","axes"],["die","dice"],["yes","yeses"],["foot","feet"],["eave","eaves"],["goose","geese"],["tooth","teeth"],["quiz","quizzes"],["human","humans"],["proof","proofs"],["carve","carves"],["valve","valves"],["looey","looies"],["thief","thieves"],["groove","grooves"],["pickaxe","pickaxes"],["whiskey","whiskies"]].forEach(function(e){return f.addIrregularRule(e[0],e[1])}),[[/s?$/i,"s"],[/[^\u0000-\u007F]$/i,"$0"],[/([^aeiou]ese)$/i,"$1"],[/(ax|test)is$/i,"$1es"],[/(alias|[^aou]us|tlas|gas|ris)$/i,"$1es"],[/(e[mn]u)s?$/i,"$1s"],[/([^l]ias|[aeiou]las|[emjzr]as|[iu]am)$/i,"$1"],[/(alumn|syllab|octop|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1i"],[/(alumn|alg|vertebr)(?:a|ae)$/i,"$1ae"],[/(seraph|cherub)(?:im)?$/i,"$1im"],[/(her|at|gr)o$/i,"$1oes"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|automat|quor)(?:a|um)$/i,"$1a"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)(?:a|on)$/i,"$1a"],[/sis$/i,"ses"],[/(?:(kni|wi|li)fe|(ar|l|ea|eo|oa|hoo)f)$/i,"$1$2ves"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/([^ch][ieo][ln])ey$/i,"$1ies"],[/(x|ch|ss|sh|zz)$/i,"$1es"],[/(matr|cod|mur|sil|vert|ind|append)(?:ix|ex)$/i,"$1ices"],[/(m|l)(?:ice|ouse)$/i,"$1ice"],[/(pe)(?:rson|ople)$/i,"$1ople"],[/(child)(?:ren)?$/i,"$1ren"],[/eaux$/i,"$0"],[/m[ae]n$/i,"men"],["thou","you"]].forEach(function(e){return f.addPluralRule(e[0],e[1])}),[[/s$/i,""],[/(ss)$/i,"$1"],[/(wi|kni|(?:after|half|high|low|mid|non|night|[^\w]|^)li)ves$/i,"$1fe"],[/(ar|(?:wo|[ae])l|[eo][ao])ves$/i,"$1f"],[/ies$/i,"y"],[/\b([pl]|zomb|(?:neck|cross)?t|coll|faer|food|gen|goon|group|lass|talk|goal|cut)ies$/i,"$1ie"],[/\b(mon|smil)ies$/i,"$1ey"],[/(m|l)ice$/i,"$1ouse"],[/(seraph|cherub)im$/i,"$1"],[/(x|ch|ss|sh|zz|tto|go|cho|alias|[^aou]us|tlas|gas|(?:her|at|gr)o|ris)(?:es)?$/i,"$1"],[/(analy|ba|diagno|parenthe|progno|synop|the|empha|cri)(?:sis|ses)$/i,"$1sis"],[/(movie|twelve|abuse|e[mn]u)s$/i,"$1"],[/(test)(?:is|es)$/i,"$1is"],[/(alumn|syllab|octop|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1us"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|quor)a$/i,"$1um"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)a$/i,"$1on"],[/(alumn|alg|vertebr)ae$/i,"$1a"],[/(cod|mur|sil|vert|ind)ices$/i,"$1ex"],[/(matr|append)ices$/i,"$1ix"],[/(pe)(rson|ople)$/i,"$1rson"],[/(child)ren$/i,"$1"],[/(eau)x?$/i,"$1"],[/men$/i,"man"]].forEach(function(e){return f.addSingularRule(e[0],e[1])}),["adulthood","advice","agenda","aid","alcohol","ammo","anime","athletics","audio","bison","blood","bream","buffalo","butter","carp","cash","chassis","chess","clothing","cod","commerce","cooperation","corps","debris","diabetes","digestion","elk","energy","equipment","excretion","expertise","flounder","fun","gallows","garbage","graffiti","headquarters","health","herpes","highjinks","homework","housework","information","jeans","justice","kudos","labour","literature","machinery","mackerel","mail","media","mews","moose","music","manga","news","pike","plankton","pliers","pollution","premises","rain","research","rice","salmon","scissors","series","sewage","shambles","shrimp","species","staff","swine","tennis","traffic","transporation","trout","tuna","wealth","welfare","whiting","wildebeest","wildlife","you",/[^aeiou]ese$/i,/deer$/i,/fish$/i,/measles$/i,/o[iu]s$/i,/pox$/i,/sheep$/i].forEach(f.addUncountableRule),f},e.exports=r()}),n=t(function(e){!function(e,t,r){function n(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var r=new function(e){var t,r=this,n=(t=4022871197,function(e){e=e.toString();for(var r=0;r<e.length;r++){var n=.02519603282416938*(t+=e.charCodeAt(r));n-=t=n>>>0,t=(n*=t)>>>0,t+=4294967296*(n-=t)}return 2.3283064365386963e-10*(t>>>0)});r.next=function(){var e=2091639*r.s0+2.3283064365386963e-10*r.c;return r.s0=r.s1,r.s1=r.s2,r.s2=e-(r.c=0|e)},r.c=1,r.s0=n(" "),r.s1=n(" "),r.s2=n(" "),r.s0-=n(e),r.s0<0&&(r.s0+=1),r.s1-=n(e),r.s1<0&&(r.s1+=1),r.s2-=n(e),r.s2<0&&(r.s2+=1),n=null}(e),i=t&&t.state,o=r.next;return o.int32=function(){return 4294967296*r.next()|0},o.double=function(){return o()+1.1102230246251565e-16*(2097152*o()|0)},o.quick=o,i&&("object"==typeof i&&n(i,r),o.state=function(){return n(r,{})}),o}t&&t.exports?t.exports=i:r&&r.amd?r(function(){return i}):this.alea=i}(0,e,!1)}),i=t(function(e){!function(e,t,r){function n(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var r=new function(e){var t=this,r="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:r+=e;for(var n=0;n<r.length+64;n++)t.x^=0|r.charCodeAt(n),t.next()}(e),i=t&&t.state,o=function(){return(r.next()>>>0)/4294967296};return o.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=r.next,o.quick=o,i&&("object"==typeof i&&n(i,r),o.state=function(){return n(r,{})}),o}t&&t.exports?t.exports=i:r&&r.amd?r(function(){return i}):this.xor128=i}(0,e,!1)}),o=t(function(e){!function(e,t,r){function n(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var r=new function(e){var t=this,r="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:r+=e;for(var n=0;n<r.length+64;n++)t.x^=0|r.charCodeAt(n),n==r.length&&(t.d=t.x<<10^t.x>>>4),t.next()}(e),i=t&&t.state,o=function(){return(r.next()>>>0)/4294967296};return o.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=r.next,o.quick=o,i&&("object"==typeof i&&n(i,r),o.state=function(){return n(r,{})}),o}t&&t.exports?t.exports=i:r&&r.amd?r(function(){return i}):this.xorwow=i}(0,e,!1)}),a=t(function(e){!function(e,t,r){function n(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var r=new function(e){var t=this;t.next=function(){var e,r,n=t.x,i=t.i;return e=n[i],r=(e^=e>>>7)^e<<24,r^=(e=n[i+1&7])^e>>>10,r^=(e=n[i+3&7])^e>>>3,r^=(e=n[i+4&7])^e<<7,e=n[i+7&7],r^=(e^=e<<13)^e<<9,n[i]=r,t.i=i+1&7,r},function(e,t){var r,n=[];if(t===(0|t))n[0]=t;else for(t=""+t,r=0;r<t.length;++r)n[7&r]=n[7&r]<<15^t.charCodeAt(r)+n[r+1&7]<<13;for(;n.length<8;)n.push(0);for(r=0;r<8&&0===n[r];++r);for(8==r?n[7]=-1:n[r],e.x=n,e.i=0,r=256;r>0;--r)e.next()}(t,e)}(e),i=t&&t.state,o=function(){return(r.next()>>>0)/4294967296};return o.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=r.next,o.quick=o,i&&(i.x&&n(i,r),o.state=function(){return n(r,{})}),o}t&&t.exports?t.exports=i:r&&r.amd?r(function(){return i}):this.xorshift7=i}(0,e,!1)}),u=t(function(e){!function(e,t,r){function n(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var r=new function(e){var t=this;t.next=function(){var e,r,n=t.w,i=t.X,o=t.i;return t.w=n=n+1640531527|0,r=i[o+34&127],e=i[o=o+1&127],r^=r<<13,e^=e<<17,r^=r>>>15,e^=e>>>12,r=i[o]=r^e,t.i=o,r+(n^n>>>16)|0},function(e,t){var r,n,i,o,a,u=[],s=128;for(t===(0|t)?(n=t,t=null):(t+="\0",n=0,s=Math.max(s,t.length)),i=0,o=-32;o<s;++o)t&&(n^=t.charCodeAt((o+32)%t.length)),0===o&&(a=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,o>=0&&(a=a+1640531527|0,i=0==(r=u[127&o]^=n+a)?i+1:0);for(i>=128&&(u[127&(t&&t.length||0)]=-1),i=127,o=512;o>0;--o)n=u[i+34&127],r=u[i=i+1&127],n^=n<<13,r^=r<<17,n^=n>>>15,r^=r>>>12,u[i]=n^r;e.w=a,e.X=u,e.i=i}(t,e)}(e),i=t&&t.state,o=function(){return(r.next()>>>0)/4294967296};return o.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=r.next,o.quick=o,i&&(i.X&&n(i,r),o.state=function(){return n(r,{})}),o}t&&t.exports?t.exports=i:r&&r.amd?r(function(){return i}):this.xor4096=i}(0,e,!1)}),s=t(function(e){!function(e,t,r){function n(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var r=new function(e){var t=this,r="";t.next=function(){var e=t.b,r=t.c,n=t.d,i=t.a;return e=e<<25^e>>>7^r,r=r-n|0,n=n<<24^n>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^r,t.c=r=r-n|0,t.d=n<<16^r>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):r+=e;for(var n=0;n<r.length+20;n++)t.b^=0|r.charCodeAt(n),t.next()}(e),i=t&&t.state,o=function(){return(r.next()>>>0)/4294967296};return o.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=r.next,o.quick=o,i&&("object"==typeof i&&n(i,r),o.state=function(){return n(r,{})}),o}t&&t.exports?t.exports=i:r&&r.amd?r(function(){return i}):this.tychei=i}(0,e,!1)}),c={},l=Object.freeze({default:c}),f=l&&c||l,p=t(function(e){!function(t,r){var n,i=this,o=256,a=6,u="random",s=r.pow(o,a),c=r.pow(2,52),l=2*c,p=o-1;function d(e,f,d){var y=[],g=m(function e(t,r){var n,i=[],o=typeof t;if(r&&"object"==o)for(n in t)try{i.push(e(t[n],r-1))}catch(e){}return i.length?i:"string"==o?t:t+"\0"}((f=1==f?{entropy:!0}:f||{}).entropy?[e,v(t)]:null==e?function(){try{var e;return n&&(e=n.randomBytes)?e=e(o):(e=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(e)),v(e)}catch(e){var r=i.navigator,a=r&&r.plugins;return[+new Date,i,a,i.screen,v(t)]}}():e,3),y),w=new function(e){var t,r=e.length,n=this,i=0,a=n.i=n.j=0,u=n.S=[];r||(e=[r++]);for(;i<o;)u[i]=i++;for(i=0;i<o;i++)u[i]=u[a=p&a+e[i%r]+(t=u[i])],u[a]=t;(n.g=function(e){for(var t,r=0,i=n.i,a=n.j,u=n.S;e--;)t=u[i=p&i+1],r=r*o+u[p&(u[i]=u[a=p&a+t])+(u[a]=t)];return n.i=i,n.j=a,r})(o)}(y),x=function(){for(var e=w.g(a),t=s,r=0;e<c;)e=(e+r)*o,t*=o,r=w.g(1);for(;e>=l;)e/=2,t/=2,r>>>=1;return(e+r)/t};return x.int32=function(){return 0|w.g(4)},x.quick=function(){return w.g(4)/4294967296},x.double=x,m(v(w.S),t),(f.pass||d||function(e,t,n,i){return i&&(i.S&&h(i,w),e.state=function(){return h(w,{})}),n?(r[u]=e,t):e})(x,g,"global"in f?f.global:this==r,f.state)}function h(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){for(var r,n=e+"",i=0;i<n.length;)t[p&i]=p&(r^=19*t[p&i])+n.charCodeAt(i++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(r["seed"+u]=d,m(r.random(),t),e.exports){e.exports=d;try{n=f}catch(e){}}else 0}([],Math)});p.alea=n,p.xor128=i,p.xorwow=o,p.xorshift7=a,p.xor4096=u,p.tychei=s;var d=p,h=function(e,t,r){var n=r?d(r):d();return Math.floor(n()*(t-e))+e},m={between:function(e,t){var r=e.split("-").map(Number);return h(r[0],r[1],t)},capitalize:function(e){return e[0].toUpperCase()+e.slice(1)},checkIfAlreadyGenerated:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object.keys(e).reduce(function(r,n){return"type"===n?r:e[n]===t[n]?r+=1:r},0)>=r},modifier:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.split("|");return function(){return function e(r,n){var i=t[n[0]]?t[n[0]].call(null,r):r;return 1===n.length?i:e(i,n.slice(1))}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r)}},pluralize:function(e){return r(e)},possessive:function(e){return e+"'s"},sample:function(e,t){return"string"==typeof e?e:e[h(0,e.length,t)]},uppercase:function(e){return e.toUpperCase()}},v=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),y=require("../helpers/functions").sample;module.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2];return Object.keys(e).reduce(function(n,i){if("|"===e[i][0]){var o=e[i].slice(1).split(":"),a=v(o,2),u=a[0],s=a[1];n[i]=t[u]?t[u](s,r):e[i]}else n[i]=y(e[i],r);return n},{})};var g=Object.freeze({}),w=function(e){switch(!0){case"|"===e[0][0]:return"helper";case"!"===e[0][0]:return"grammar";case e[e.length-1].includes("|"):return"modifiedModel";default:return"model"}};module.exports={grammarExpander:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=/::\.|[^ ]*::/g;return t.replace(n,function(t){if("!"!==t[2])return t;var i=t.slice(3,-2).split("."),o=i.reduce(function(e,t){return e[t]?e[t]:new Error("The grammar: "+i+" does not appear to exist")},r);return o instanceof Error?o:null===o.match(n)?o:e(o,r)})},modeler:function(e){var t={modCha:["model","character","property","modifier"],mod:["model","property","modifier"],cha:["model","character","property"],gen:["model","property"]};return e.map(function(e){return"helper"===e.type||"grammar"===e.type?e:("modifiedModel"===e.type?4===e.toParse.length?t.modCha:t.mod:3===e.toParse.length?t.cha:t.gen).reduce(function(t,r,n){return t[r]=e.toParse[n],Object.assign({},t,{type:"model"})},{})})},parser:function(e){var t=function(e,t){switch(e){case"helper":return{type:e,helper:t[0],input:t[1]};case"grammar":return{type:e,grammar:t[0]};default:return{type:e,toParse:t}}};return e.map(function(e){var r=e.slice(2,-2).split("."),n=w(r);if("helper"===n)return t(n,r[0].slice(1).split(":"));if("grammar"===n){var i=[r[0].slice(1)].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(r.slice(1))).join(".");return t(n,[i])}var o,a=r.pop().split("|"),u=(o=a,Array.isArray(o)?o:Array.from(o)),s=u[0],c=u.slice(1);return t(n,"modifiedModel"===n?r.concat(s,[c]):r.concat(s))})},propType:w,regexer:function(e){var t=e.match(/::\.|[^ ]*::/g);return null===t?[]:t}};var x=Object.freeze({}),b=x.grammarExpander,$=x.regexer,A=x.parser,j=x.modeler,k=function(e,t){var r=b(e,t),n=$(r);return n=A(n),{toModel:n=j(n),expandedGrammar:r}},I="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function q(){throw new Error("setTimeout has not been defined")}function z(){throw new Error("clearTimeout has not been defined")}var T=q,C=z;function S(e){if(T===setTimeout)return setTimeout(e,0);if((T===q||!T)&&setTimeout)return T=setTimeout,setTimeout(e,0);try{return T(e,0)}catch(t){try{return T.call(null,e,0)}catch(t){return T.call(this,e,0)}}}"function"==typeof I.setTimeout&&(T=setTimeout),"function"==typeof I.clearTimeout&&(C=clearTimeout);var E,O=[],P=!1,R=-1;function M(){P&&E&&(P=!1,E.length?O=E.concat(O):R=-1,O.length&&L())}function L(){if(!P){var e=S(M);P=!0;for(var t=O.length;t;){for(E=O,O=[];++R<t;)E&&E[R].run();R=-1,t=O.length}E=null,P=!1,function(e){if(C===clearTimeout)return clearTimeout(e);if((C===z||!C)&&clearTimeout)return C=clearTimeout,clearTimeout(e);try{C(e)}catch(t){try{return C.call(null,e)}catch(t){return C.call(this,e)}}}(e)}}function U(e,t){this.fun=e,this.array=t}U.prototype.run=function(){this.fun.apply(null,this.array)};function D(){}var N=D,X=D,G=D,W=D,B=D,F=D,V=D;var _=I.performance||{},H=_.now||_.mozNow||_.msNow||_.oNow||_.webkitNow||function(){return(new Date).getTime()};var J=new Date;var K={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];O.push(new U(e,t)),1!==O.length||P||S(L)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:N,addListener:X,once:G,off:W,removeListener:B,removeAllListeners:F,emit:V,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*H.call(_),r=Math.floor(t),n=Math.floor(t%1*1e9);return e&&(r-=e[0],(n-=e[1])<0&&(r--,n+=1e9)),[r,n]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-J)/1e3}};const Q=require("util"),Y=require("path"),Z=require("./append"),ee=require("./dir"),te=require("./file"),re=require("./find"),ne=require("./inspect"),ie=require("./inspect_tree"),oe=require("./copy"),ae=require("./exists"),ue=require("./list"),se=require("./move"),ce=require("./read"),le=require("./remove"),fe=require("./rename"),pe=require("./symlink"),de=require("./streams"),he=require("./write"),me=e=>{const t=()=>e||K.cwd(),r=function(){if(0===arguments.length)return t();const e=Array.prototype.slice.call(arguments),r=[t()].concat(e);return me(Y.resolve.apply(null,r))},n=e=>Y.resolve(t(),e),i=e=>{const r=e||{};return r.cwd=t(),r},o={cwd:r,path:function(){return Array.prototype.unshift.call(arguments,t()),Y.resolve.apply(null,arguments)},append:(e,t,r)=>{Z.validateInput("append",e,t,r),Z.sync(n(e),t,r)},appendAsync:(e,t,r)=>(Z.validateInput("appendAsync",e,t,r),Z.async(n(e),t,r)),copy:(e,t,r)=>{oe.validateInput("copy",e,t,r),oe.sync(n(e),n(t),r)},copyAsync:(e,t,r)=>(oe.validateInput("copyAsync",e,t,r),oe.async(n(e),n(t),r)),createWriteStream:(e,t)=>de.createWriteStream(n(e),t),createReadStream:(e,t)=>de.createReadStream(n(e),t),dir:(e,t)=>{ee.validateInput("dir",e,t);const i=n(e);return ee.sync(i,t),r(i)},dirAsync:(e,t)=>(ee.validateInput("dirAsync",e,t),new Promise((i,o)=>{const a=n(e);ee.async(a,t).then(()=>{i(r(a))},o)})),exists:e=>(ae.validateInput("exists",e),ae.sync(n(e))),existsAsync:e=>(ae.validateInput("existsAsync",e),ae.async(n(e))),file:(e,t)=>(te.validateInput("file",e,t),te.sync(n(e),t),o),fileAsync:(e,t)=>(te.validateInput("fileAsync",e,t),new Promise((r,i)=>{te.async(n(e),t).then(()=>{r(o)},i)})),find:(e,t)=>(void 0===t&&"object"==typeof e&&(t=e,e="."),re.validateInput("find",e,t),re.sync(n(e),i(t))),findAsync:(e,t)=>(void 0===t&&"object"==typeof e&&(t=e,e="."),re.validateInput("findAsync",e,t),re.async(n(e),i(t))),inspect:(e,t)=>(ne.validateInput("inspect",e,t),ne.sync(n(e),t)),inspectAsync:(e,t)=>(ne.validateInput("inspectAsync",e,t),ne.async(n(e),t)),inspectTree:(e,t)=>(ie.validateInput("inspectTree",e,t),ie.sync(n(e),t)),inspectTreeAsync:(e,t)=>(ie.validateInput("inspectTreeAsync",e,t),ie.async(n(e),t)),list:e=>(ue.validateInput("list",e),ue.sync(n(e||"."))),listAsync:e=>(ue.validateInput("listAsync",e),ue.async(n(e||"."))),move:(e,t)=>{se.validateInput("move",e,t),se.sync(n(e),n(t))},moveAsync:(e,t)=>(se.validateInput("moveAsync",e,t),se.async(n(e),n(t))),read:(e,t)=>(ce.validateInput("read",e,t),ce.sync(n(e),t)),readAsync:(e,t)=>(ce.validateInput("readAsync",e,t),ce.async(n(e),t)),remove:e=>{le.validateInput("remove",e),le.sync(n(e||"."))},removeAsync:e=>(le.validateInput("removeAsync",e),le.async(n(e||"."))),rename:(e,t)=>{fe.validateInput("rename",e,t),fe.sync(n(e),t)},renameAsync:(e,t)=>(fe.validateInput("renameAsync",e,t),fe.async(n(e),t)),symlink:(e,t)=>{pe.validateInput("symlink",e,t),pe.sync(e,n(t))},symlinkAsync:(e,t)=>(pe.validateInput("symlinkAsync",e,t),pe.async(e,n(t))),write:(e,t,r)=>{he.validateInput("write",e,t,r),he.sync(n(e),t,r)},writeAsync:(e,t,r)=>(he.validateInput("writeAsync",e,t,r),he.async(n(e),t,r))};return void 0!==Q.inspect.custom&&(o[Q.inspect.custom]=(()=>`[fs-jetpack CWD: ${t()}]`)),o};module.exports=me;var ve=Object.freeze({})();function ye(e,t){for(var r=0,n=e.length-1;n>=0;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}var ge=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,we=function(e){return ge.exec(e).slice(1)};function xe(){for(var e="",t=!1,r=arguments.length-1;r>=-1&&!t;r--){var n=r>=0?arguments[r]:"/";if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");n&&(e=n+"/"+e,t="/"===n.charAt(0))}return(t?"/":"")+(e=ye(Te(e.split("/"),function(e){return!!e}),!t).join("/"))||"."}function be(e){var t=$e(e),r="/"===Ce(e,-1);return(e=ye(Te(e.split("/"),function(e){return!!e}),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e}function $e(e){return"/"===e.charAt(0)}function Ae(){return be(Te(Array.prototype.slice.call(arguments,0),function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))}function je(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=xe(e).substr(1),t=xe(t).substr(1);for(var n=r(e.split("/")),i=r(t.split("/")),o=Math.min(n.length,i.length),a=o,u=0;u<o;u++)if(n[u]!==i[u]){a=u;break}var s=[];for(u=a;u<n.length;u++)s.push("..");return(s=s.concat(i.slice(a))).join("/")}function ke(e){var t=we(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."}function Ie(e,t){var r=we(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r}function qe(e){return we(e)[3]}var ze={extname:qe,basename:Ie,dirname:ke,sep:"/",delimiter:":",relative:je,join:Ae,isAbsolute:$e,normalize:be,resolve:xe};function Te(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}var Ce="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)},Se=Object.freeze({resolve:xe,normalize:be,isAbsolute:$e,join:Ae,relative:je,sep:"/",delimiter:":",dirname:ke,basename:Ie,extname:qe,default:ze}),Ee=Se&&ze||Se,Oe=function(e){return ve.find(Ee.resolve(""+e),{matching:"*.json"}).reduce(function(e,t){var r=ve.read(t,"json");return["model","grammar"].forEach(function(t){r[t]&&Object.keys(r[t]).forEach(function(n){e[t][n]?e[t][n]=[].concat(e[t][n],r[t][n]):e[t][n]=r[t][n]})}),r.entry&&(e.entry=r.entry),Object.assign({},e)},{model:{},grammar:{},entry:null})};return function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.state?r.state:{},i=r.modifiers?r.modifiers:{},o="string"==typeof t?Oe(t):t;n="string"==typeof n?Oe(n):n,i=Object.assign({},m,i);var a=o.grammar,u=k(o.entry,a),s=u.expandedGrammar,c=u.toModel.map(function(e){if("helper"===e.type)return i[e.helper](e.input);var t=n[e.character]||g(o.model[e.model],i);e.character&&(n[e.character]=t);var r=t[e.property];return e.modifier&&(r=e.modifier.reduce(function(e,t){return(0,i[t])(e)},r)),r});return{compiled:e(s,c),state:n}}});
